<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>手機版自架電商範例</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
  .container { width: 95%; max-width: 600px; margin: 0 auto; padding: 10px; }
  h1 { text-align: center; font-size: 1.5em; margin: 15px 0; }
  .products, .cart { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
  .product, .cart-item { background: #fff; padding: 10px; border-radius: 8px; display: flex; gap: 10px; align-items: center; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
  .product img, .cart-item img { width: 100px; height: 80px; object-fit: cover; border-radius: 4px; }
  .product-info, .cart-info { flex: 1; }
  .product button, .cart button { margin-top: 5px; padding: 8px; background: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer; width: 100%; }
  .product button:hover, .cart button:hover { background: #0056b3; }
  .cart-summary { text-align: right; margin-top: 10px; }
  #checkout-btn { width: 100%; padding: 10px; background: #28a745; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 1em; }
  #checkout-btn:hover { background: #218838; }

  /* Modal */
  .modal { display: none; position: fixed; z-index: 10; left:0; top:0; width:100%; height:100%; background: rgba(0,0,0,0.5); }
  .modal-content { background:#fff; margin: 5% auto; padding:20px; width:95%; max-width:400px; border-radius:8px; position: relative; }
  .close { position: absolute; top:10px; right:15px; font-size:18px; cursor:pointer; }
  label { display:block; margin:10px 0 5px; }
  input, select { width:100%; padding:8px; margin-bottom:10px; border-radius:4px; border:1px solid #ccc; font-size:1em; }
  .submit-btn { width:100%; padding:10px; background:#28a745; color:#fff; border:none; border-radius:4px; cursor:pointer; font-size:1em; }
  .submit-btn:hover { background:#218838; }

  @media (max-width:400px){
    .product img, .cart-item img { width: 80px; height: 60px; }
  }
</style>
</head>
<body>
<div class="container">
  <h1>商品列表</h1>
  <div class="products" id="product-list"></div>

  <h1>購物車</h1>
  <div class="cart" id="cart-list"></div>
  <div class="cart-summary">
    總金額: NT$<span id="cart-total">0</span>
    <button id="checkout-btn">下單</button>
  </div>
</div>

<!-- 下單彈窗 -->
<div class="modal" id="checkout-modal">
  <div class="modal-content">
    <span class="close" id="close-modal">&times;</span>
    <h2>選擇付款方式 & 填寫收件資料</h2>
    <form id="checkout-form">
      <label for="payment">付款方式</label>
      <select id="payment" required>
        <option value="">請選擇</option>
        <option value="貨到付款">貨到付款</option>
        <option value="匯款轉帳">匯款轉帳</option>
      </select>
      <label for="name">收件姓名</label>
      <input type="text" id="name" required>
      <label for="phone">聯絡電話</label>
      <input type="text" id="phone" required>
      <label for="address">收貨地址</label>
      <input type="text" id="address" required>
      <button type="submit" class="submit-btn">確認下單</button>
    </form>
  </div>
</div>

<script>
const products = [
  {id:1, name:"商品A", price:500, img:"https://via.placeholder.com/200x150?text=商品A"},
  {id:2, name:"商品B", price:1200, img:"https://via.placeholder.com/200x150?text=商品B"},
  {id:3, name:"商品C", price:800, img:"https://via.placeholder.com/200x150?text=商品C"},
];

// 讀取購物車資料
let cart = JSON.parse(localStorage.getItem('cart')) || [];
let orders = JSON.parse(localStorage.getItem('orders')) || [];

// Render 商品
function renderProducts(){
  const list = document.getElementById('product-list');
  list.innerHTML = '';
  products.forEach(p=>{
    const div = document.createElement('div');
    div.className = 'product';
    div.innerHTML = `
      <img src="${p.img}" alt="${p.name}">
      <div class="product-info">
        <h3>${p.name}</h3>
        <p>NT$${p.price}</p>
        <button onclick="addToCart(${p.id})">加入購物車</button>
      </div>
    `;
    list.appendChild(div);
  });
}

// Render 購物車
function renderCart(){
  const list = document.getElementById('cart-list');
  const totalEl = document.getElementById('cart-total');
  list.innerHTML = '';
  let total = 0;
  cart.forEach(item=>{
    total += item.price * item.qty;
    const div = document.createElement('div');
    div.className = 'cart-item';
    div.innerHTML = `
      <img src="${item.img}" alt="${item.name}">
      <div class="cart-info">
        <h4>${item.name}</h4>
        <p>單價: NT$${item.price}</p>
        <p>數量: <input type="number" min="1" value="${item.qty}" onchange="updateQty(${item.id},this.value)"></p>
        <p>小計: NT$${item.price * item.qty}</p>
        <button onclick="removeFromCart(${item.id})">刪除</button>
      </div>
    `;
    list.appendChild(div);
  });
  totalEl.textContent = total;
  localStorage.setItem('cart', JSON.stringify(cart)); // 儲存購物車
}

// 加入購物車
function addToCart(id){
  const product = products.find(p=>p.id===id);
  const cartItem = cart.find(c=>c.id===id);
  if(cartItem){
    cartItem.qty++;
  }else{
    cart.push({...product, qty:1});
  }
  renderCart();
}

// 刪除商品
function removeFromCart(id){
  cart = cart.filter(c=>c.id!==id);
  renderCart();
}

// 更新數量
function updateQty(id, value){
  const item = cart.find(c=>c.id===id);
  item.qty = parseInt(value);
  if(item.qty < 1) item.qty = 1;
  renderCart();
}

// 下單彈窗
const modal = document.getElementById('checkout-modal');
const checkoutBtn = document.getElementById('checkout-btn');
const closeModal = document.getElementById('close-modal');
const form = document.getElementById('checkout-form');

checkoutBtn.onclick = ()=>{
  if(cart.length === 0){
    alert("購物車是空的！");
    return;
  }
  modal.style.display = 'block';
}
closeModal.onclick = ()=> modal.style.display = 'none';
window.onclick = (e)=>{ if(e.target==modal) modal.style.display='none'; }

form.onsubmit = function(e){
  e.preventDefault();
  const payment = document.getElementById('payment').value;
  const name = document.getElementById('name').value;
  const phone = document.getElementById('phone').value;
  const address = document.getElementById('address').value;

  if(!payment || !name || !phone || !address){
    alert("請填寫完整資料！");
    return;
  }

  const order = {
    items: cart,
    total: cart.reduce((sum,i)=>sum+i.price*i.qty,0),
    payment, name, phone, address,
    date: new Date().toLocaleString()
  };

  orders.push(order);
  localStorage.setItem('orders', JSON.stringify(orders)); // 儲存下單資料

  alert("下單成功！請依付款方式完成交易。");

  cart = [];
  localStorage.setItem('cart', JSON.stringify(cart));
  renderCart();
  form.reset();
  modal.style.display = 'none';
  console.log("所有訂單資料:", orders);
}

renderProducts();
renderCart();
</script>
</body>
</html>
